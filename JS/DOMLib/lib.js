const DOMLib=function(){function a(a){return new Promise(function(c,d){let b=new XMLHttpRequest;b.open("GET",a,!0),b.onreadystatechange=function(){if(b.readyState===XMLHttpRequest.DONE){if(200===b.status){let a=b.getResponseHeader("Content-Type");1!==a.indexOf("text")?c(b.responseText):c(b.response)}else d(b)}},b.send(null)})}function b(b,c,d,e){this.title=b,this.htmlDirectory=c,this.htmlPartial=null,this.htmlPartialLoaded=!1,a(this.htmlDirectory).then(a=>{this.htmlPartial=a,this.htmlPartialLoaded=!0,e.$progress()}),this.jsControllerDirectory=d,this.jsController=null,this.jsControllerLoaded=!1,a(this.jsControllerDirectory).then(a=>{this.jsController=a,this.jsControllerLoaded=!0,e.$progress()})}function c(a,b,c){this.name=a,this.value=b,this.settings=c}class d{constructor(a){this.name=a,this.Variables=[]}DOM(d,e,f=null,g=null,a=[]){let c=g?g.childNodes:document.childNodes;for(let b=0;b<c.length;b++)c[b]&&((!f||c[b].tagName===f.toUpperCase())&&"getAttribute"in c[b]&&c[b].getAttribute(d)&&c[b].getAttribute(d)===e&&a.push(c[b]),c[b].childNodes.length>0&&this.DOM(d,e,f,c[b],a));if(0===a.length){let h=document.getElementById(d),i=document.getElementById(e);h&&a.push(h),i&&a.push(i);let j=Array.from(document.getElementsByTagName(d)),k=Array.from(document.getElementsByTagName(e));j.length>0&&a.push(...j),k.length>0&&a.push(...k)}return a.length>1?a:1===a.length?a[0]:null}CreateVariable(d,e,f=["out"]){for(let b=0;b<this.Variables.length;b++)if(this.Variables[b].name===d)return this.Variables[b].value=e,this.Variables[b].settings=f,console.warn("[DOMLibController] Called APP.CreateVariable with the same name as another variable ("+d+"), previous variable overwritten (to set a variable use APP.SetVariable(name, value))."),this.Variables[b];let a=new c(d,e,f);return void 0!==a.value&&a.settings.includes("out")&&this.DOM("name",a.name,"variable")&&(this.DOM("name",a.name,"variable").textContent=a.value),a.settings.includes("in")&&this.DOM("name",a.name,"variable")&&(a.value=this.DOM("name",a.name,"variable").textContent),this.Variables.push(a),a.value}GetVariable(b){for(let a=0;a<this.Variables.length;a++)if(this.Variables[a].name===b)return this.Variables[a].settings.includes("in")&&this.DOM("name",this.Variables[a].name,"variable")&&(this.Variables[a].value=this.DOM("name",this.Variables[a].name,"variable").textContent),this.Variables[a];return null}SetVariable(b,c){for(let a=0;a<this.Variables.length;a++)if(this.Variables[a].name===b){this.Variables[a].value=c,this.Variables[a].settings.includes("out")&&this.DOM("name",this.Variables[a].name,"variable")&&(this.DOM("name",this.Variables[a].name,"variable").textContent=this.Variables[a].value);break}return null}}class e{constructor(c){this.$appName=c,this.$pages=[],this.$pageContentLoaded=0,this.Page=null,this.onload=function(){},this.Controllers=[];let a=document.getElementsByTagName("title");if(a.length>0)a[0].innerHTML=this.$appName;else{let b=document.createElement("title");b.textContent=this.$appName,document.getElementsByTagName("head")[0].append(b)}}Input(a,b){return new Promise(function(i,j){let g=document.getElementsByTagName("body")[0],d=document.createElement("dialog");d.style["background-color"]="#c8c8c8",d.style["border-radius"]="10px";let f=document.createElement("h2");f.textContent=a,d.appendChild(f);let h=document.createElement("input");d.appendChild(h),d.appendChild(document.createElement("br")),d.appendChild(document.createElement("br"));for(let e=0;e<b.length;e++){let c=document.createElement("button");c.style["padding-left"]=c.style["padding-right"]="6px",c.style["padding-top"]=c.style["padding-bottom"]="4px",c.style["border-radius"]="6px",c.style.cursor="pointer","Ok"===b[e]||"Submit"===b[e]?(c.style["background-color"]="#1e90ff",c.style.border="2px solid #4682b4",c.style["border-radius"]="4px",c.style.color="#ffffff"):("Cancel"===b[e]||"Close"===b[e])&&(c.style["background-color"]="#fa7575",c.style.border="2px solid #b55757",c.style["border-radius"]="4px",c.style.color="#ffffff"),c.textContent=b[e],c.addEventListener("click",function(){"Ok"===c.textContent||"Submit"===c.textContent?i(h.value):("Cancel"===c.textContent||"Close"===c.textContent)&&j("cancelled"),g.removeChild(d)}),d.appendChild(c)}g.appendChild(d),d.showModal()})}$progress(){this.$pageContentLoaded++,this.$pageContentLoaded===2*this.$pages.length&&(this.onload(),this.onload=function(){})}GetPage(b){for(let a=0;a<this.$pages.length;a++)if(this.$pages[a].title===b)return this.$pages[a];return null}CreatePage(a,c,d){return this.$pages.push(new b(a,c,d,this))}RefreshAllContent(){this.$pageContentLoaded=0,this.$pages.forEach(function(a){return a=new b(a.title,a.htmlDirectory,a.jsControllerDirectory,this)})}Render(b){if(b||""===this.Page||"string"!=typeof this.Page){if(this.$pages.length>0)b?this.Page=this.GetPage(b).title:this.Page=this.$pages[0].title;else throw new Error("[APP] No pages created, create at least one page before rendering the page.")}let a=this.GetPage(this.Page);if(!a.htmlPartialLoaded||!a.jsControllerLoaded)throw new Error("[APP] Page cannot be rendered, content not yet loaded. (Use APP.onload to ensure page contents are not used before loaded.)");document.getElementsByTagName("body")[0].innerHTML=a.htmlPartial,document.getElementsByTagName("condition");let c=document.createElement("script");c.textContent=a.jsController,document.getElementsByTagName("body")[0].appendChild(c)}Controller(b){let a=new d(b);return this.Controllers.push(a),a}}return{Init:function(a){return delete this.Init,new e(a)},GET:a}}();console.log("Loaded DOMLib by Matthew James")
